BAŞLIK: CART (CLASSIFICATION & REGRESSION TREES) - TAM KAPSAMLI SÜRÜM
TÜR: Karar Ağacı Algoritması, Regresyon Mantığı ve Dallanma Matematiği

================================================================================
1. GİRİŞ: CART NEDİR?
================================================================================
CART (Sınıflandırma ve Regresyon Ağaçları), karmaşık veri setlerini basit "Evet/Hayır" soruları sorarak parçalara ayıran ve bu süreci hiyerarşik bir ağaç yapısında modelleyen algoritmadır.

Temel Mantık:
Veri uzayını dikdörtgenler prizması şeklinde bölgelere ayırır ve her bölge için sabit bir tahmin değeri atar.

--------------------------------------------------------------------------------
ÖRNEK SENARYO (Banka Kredisi)
--------------------------------------------------------------------------------
Amaç: Bir müşteriye kredi verip vermemeye karar vermek.
Veri Seti: Gelir, Kredi Notu, Yaş.
CART Yaklaşımı:
- Soru 1: Geliri 10.000 TL'den az mı? -> Evet.
- Soru 2: (Alt Dal) Öğrenci mi? -> Evet.
- Karar (Yaprak): Kredi Verme (Riskli).

================================================================================
2. AĞACIN ANATOMİSİ
================================================================================
Ağaç yukarıdan aşağıya (kökten yaprağa) büyür.

1. Kök Düğüm (Root Node):
   - Tüm verinin olduğu başlangıç noktasıdır. En iyi ayrıştırıcı soru buradadır.
   - Örnek: "Evli mi Bekar mı?" (Bu soru veriyi en iyi ikiye ayıran sorudur).

2. İç Düğümler (Decision Nodes):
   - Karar verilen ara istasyonlardır.
   - Örnek: Kökten "Evli" tarafına gidenler için yeni soru: "Çocuğu var mı?"

3. Yaprak Düğümler (Leaf Nodes):
   - Artık soru sorulmaz, SONUÇ verilir.
   - Örnek: "Kredi Onaylandı" veya "Maaş Tahmini: 25.000 TL".

================================================================================
3. BÖLÜNME KRİTERLERİ (SPLITTING CRITERIA)
================================================================================
Ağaç nereden bölüneceğine nasıl karar verir? Amaç homojenliktir (Safiyet).

A. SINIFLANDIRMA İÇİN: GINI SAFSIZLIĞI (GINI IMPURITY)
Bir kutudaki (düğümdeki) nesnelerin ne kadar karışık olduğunu ölçer.
- Formül: 1 - toplam(p_i^2)
- Hedef: 0 olmasıdır (Tam Safiyet).

--------------------------------------------------------------------------------
ÖRNEK (Meyve Sepeti)
--------------------------------------------------------------------------------
- Durum 1 (Saf): Sepette sadece 10 Elma var.
  * Olasılık (Elma) = 1.0.
  * Gini = 1 - (1^2) = 0. (Mükemmel, bölmeye gerek yok).

- Durum 2 (Karışık): Sepette 5 Elma, 5 Armut var.
  * Olasılıklar = 0.5, 0.5.
  * Gini = 1 - (0.5^2 + 0.5^2) = 1 - 0.5 = 0.5. (Maksimum kirlilik, hemen burayı bölmeliyiz!).

B. REGRESYON İÇİN: MSE (MEAN SQUARED ERROR) / VARYANS
Sayısal tahminlerde "çeşitlilik" (varyans) hatadır. Varyansı düşürmeye çalışırız.

--------------------------------------------------------------------------------
ÖRNEK (Ev Fiyatları)
--------------------------------------------------------------------------------
- Düğümdeki Evler: [100k, 900k, 120k].
- Durum: Varyans çok yüksek (900k işi bozuyor). Burası kötü bir yaprak olur.
- Eylem: "Havuzu Var mı?" sorusuyla böl.
  * Sol Yaprak: [100k, 120k] -> Varyans düşük (İyi).
  * Sağ Yaprak: [900k] -> Varyans 0 (Mükemmel).

================================================================================
4. REGRESYON PROBLEMLERİNDE CART YAPISI VE COST FUNCTION
================================================================================
Kullanıcıların en çok karıştırdığı yer burasıdır. Karar ağacı nasıl sayı tahmin eder?

A. Nasıl Tahmin Eder? (Ortalama Mantığı)
Sınıflandırma ağaçları "Çoğunluk Oyu" (Mode) kullanırken, Regresyon ağaçları yapraktaki elemanların ORTALAMASINI (Mean) alır.

--------------------------------------------------------------------------------
ÖRNEK SENARYO (Araba Fiyatı)
--------------------------------------------------------------------------------
Yeni bir araba geldi, özellikleri ağaçta takip edildi ve 3. Yaprağa düştü.
3. Yaprakta eğitim setinden kalan şu arabalar var:
- Araba A: 500.000 TL
- Araba B: 520.000 TL
- Araba C: 480.000 TL

Tahmin: (500+520+480) / 3 = 500.000 TL.

B. Cost (Objective) Function Nedir?
Modelin minimize etmeye çalıştığı amaç fonksiyonudur.
CART Regresyon ağacı için bu fonksiyon, bölünme sonrası oluşan sol ve sağ düğümlerin ağırlıklı MSE (Hata Kareler Ortalaması) toplamıdır.

Amaç Fonksiyonu: J(k, t_k) = (m_sol / m) * MSE_sol + (m_sag / m) * MSE_sag

- Mantık: Öyle bir yerden böl ki, sol taraftaki evlerin fiyatları birbirine çok benzesin (Düşük MSE), sağ taraftakiler de birbirine çok benzesin.
- Eğer bir bölünme sonucunda sol tarafta [100k, 10M] gibi uçuk farklar kalıyorsa, Cost Function yüksek çıkar ve o bölünme reddedilir.

================================================================================
5. DALLANMA ALGORİTMASI: BİLGİSAYAR NASIL SEÇER? (THE LOOP)
================================================================================
Bir insan veriye bakıp "Şuradan bölsem iyi olur" diyebilir ama bilgisayar bunu göremez. Bilgisayar "Brute Force" (Kaba Kuvvet) yöntemiyle çalışır.

Süreç Şöyle İşler:

Adım 1: Her Sütunu Gez (Feature Iteration)
Veri setinde "Yaş", "Maaş", "Eğitim" sütunları varsa sırayla hepsini alır.

Adım 2: Her Değeri Dene (Threshold Iteration)
"Yaş" sütunundaki verileri sıralar (20, 25, 30...) ve aralarına sanal sınırlar çizer.
- Deneme 1: Yaş < 22.5 mu?
- Deneme 2: Yaş < 27.5 mu?

Adım 3: Kazancı Hesapla (Calculation)
Her deneme için veriyi sanal olarak ikiye ayırır ve "Bilgi Kazancı"nı (Information Gain) hesaplar.

--------------------------------------------------------------------------------
EK BÖLÜM: DETAYLI HESAPLAMA ÖRNEĞİ (2. SEVİYE GINI HESABI)
--------------------------------------------------------------------------------
Bu bölüm, bilgisayarın "2. Seviye"de ne yaptığını matematiksel olarak gösterir.
Senaryo: Bir sınıfta 30 öğrenci var (15 Başarılı, 15 Başarısız).
Başlangıç (Kök) Gini: 1 - ((15/30)^2 + (15/30)^2) = 0.5 (Maksimum Karışıklık)

Soru: "Derse Katılımı Yüksek mi?"
Bu soru sınıfı ikiye böler:

1. SOL DAL (Evet Diyenler - 20 Kişi):
   - İçerik: 18 Başarılı, 2 Başarısız.
   - Gini(Sol) = 1 - ((18/20)^2 + (2/20)^2)
   - Gini(Sol) = 1 - (0.81 + 0.01) = 0.18 (Oldukça Saf)

2. SAĞ DAL (Hayır Diyenler - 10 Kişi):
   - İçerik: 2 Başarılı, 8 Başarısız.
   - Gini(Sağ) = 1 - ((2/10)^2 + (8/10)^2)
   - Gini(Sağ) = 1 - (0.04 + 0.64) = 0.32

3. AĞIRLIKLI ORTALAMA GINI (Weighted Average Gini):
   İşte "Bölünme Sonrası Gini" budur. Dalların büyüklüğüne göre ağırlık alınır.
   Formül: (Sol_Sayısı / Toplam) * Gini(Sol) + (Sağ_Sayısı / Toplam) * Gini(Sağ)
   Hesap: (20/30 * 0.18) + (10/30 * 0.32)
        = (0.66 * 0.18) + (0.33 * 0.32)
        = 0.12 + 0.106
        = 0.226

4. BİLGİ KAZANCI (Information Gain):
   Başlangıç Gini - Yeni Ağırlıklı Gini
   0.5 - 0.226 = 0.274

SONUÇ: Bilgisayar bu 0.274 puanını "Derse Katılım" sorusuna verir. Eğer "Ödev Yaptı mı?" sorusunun kazancı 0.15 çıkarsa, kazanan "Derse Katılım" olur ve ağaç oradan bölünür.

================================================================================
6. AŞIRI ÖĞRENME (OVERFITTING) VE BUDAMA
================================================================================
Karar ağaçları ezberlemeye bayılır.

--------------------------------------------------------------------------------
ÖRNEK SENARYO (Öğrenci Ezberi)
--------------------------------------------------------------------------------
- Overfit Ağaç: Her öğrenci için özel kural yazar.
  "Öğrenci numarası 101 ise Notu 90", "Numarası 102 ise Notu 45"...
  Bu ağaç eğitim verisinde %100 başarılıdır ama yeni gelen 103 numaralı öğrenciyi bilemez.

- İdeal Ağaç (Budanmış): Genelleme yapar.
  "Çalışma saati > 5 ise Notu 85", "Çalışma saati < 2 ise Notu 40".

Çözüm Yöntemleri:
1. Pre-Pruning (Ön Budama): "Ağaç derinliği en fazla 3 olsun" demek. (Max Depth).
2. Min Samples Leaf: "Bir yaprakta en az 10 kişi yoksa o grubu oluşturma" demek.

================================================================================
7. AVANTAJLAR VE DEZAVANTAJLAR (SENARYOLU)
================================================================================

AVANTAJLAR:
1. Yorumlanabilirlik: Bankacı müşteriye, "Yaşın genç VE gelirin düşük olduğu için reddedildin" diyebilir. (Sinir ağlarında bunu diyemez).
2. Veri Hazırlığı: Veriyi 0-1 arasına sıkıştırmaya (Scaling) gerek yoktur.
   - Örnek: "Yaş: 60" ve "Maaş: 50.000" sayılarını olduğu gibi kullanabilir.

DEZAVANTAJLAR:
1. Kararsızlık (Instability): Veriye tek bir kişi eklense, ağacın tepesindeki soru değişebilir.
   - Örnek: Veriye "Ali" eklendi, kök düğüm "Yaş" iken birden "Gelir" oldu.
2. Ortogonal Sınırlar: Sadece yatay ve dikey çizgiler çizebilir. Çapraz (Diagonal) ayrımları yapamaz.
   - Örnek: "x > y ise A sınıfı" gibi basit bir ilişkiyi bile merdiven basamakları çizerek anlamaya çalışır.

================================================================================
ÖZET TABLO
================================================================================
ÖZELLİK             | AÇIKLAMA
------------------- | -----------------------------------------
Problem Türü        | Sınıflandırma (Gini), Regresyon (MSE)
Cost Function       | Bölünmelerin ağırlıklı safsızlık/varyans toplamı
Dallanma Mantığı    | Brute Force ile en yüksek Kazancı (Gain) arama
Tahmin (Class)      | Yapraktaki çoğunluk sınıfı (Mod)
Tahmin (Reg)        | Yapraktaki değerlerin ortalaması (Mean)
En Büyük Risk       | Ezberleme (Overfitting)
Çözüm               | Max_Depth, Min_Samples_Leaf ayarları